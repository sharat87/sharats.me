<!doctype html>
<html lang=en>
<meta charset=utf-8>
<title>
	{%- if title -%}
	{{ title + " | " }}
	{%- elif post and post.meta.title -%}
	{{ post.meta.title + ' | ' }}
	{%- endif -%}
	{{ config.site_title -}}
</title>
<meta name=viewport content="width=device-width, initial-scale=1.0">
<meta name=author content="{{ config.author }}">

{%- if post and post.meta and post.meta.desc %}
<meta name=description content='{{ post.meta.desc }}'>
{%- elif post and post.tags %}
<meta name=description content='An article about {{ post.tags | en_join }}.'>
{%- else %}
<meta name=description content='An blog/article about Python, JavaScript, ViM and other software stuff.'>
{%- endif %}

{%- if not config.dev_mode and config.adsense %}
<script data-ad-client="ca-pub-1813617733171441" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
{%- endif %}

<link rel=stylesheet href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:400,400i,600,600i|Fira+Code:400,600&display=swap">
<link rel=stylesheet href="/styles.css">
<style>.hide,.sr-only{display:none !important}</style>

<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">

<header>
	<input class=nav-toggle name=nav-toggle id=nav-toggle type=checkbox>
	<div class=compact>
		<h1><a href=/ rel=home>{{ config.site_title }}</a></h1>
		<label class=nav-toggle for=nav-toggle>&#9776;<span class=sr-only>Toggle Menu</span></label>
	</div>
	<nav>
		<a href='/archive/'>Archive</a>
		<a href='/labs/'>Labs</a>
		<a href='/shrikant-sharat-kandula-resume.pdf'>Résumé</a>
		<a href='{{ config.feedburner_url }}'>RSS</a>
		<a href='/about/'>About</a>
	</nav>
</header>

<noscript>
	<p class=warning>This website requires JavaScript to operate correctly. Functionality
	may be limited when it's turned off.</p>
</noscript>

<main>{% block main %}{% endblock %}</main>

<footer>
	<div class=content>
		<p>Copyright &copy; 2010-2020, {{ config.author }}.
			{% if config.adsense %}This website serves third-party ads.{% endif %}</p>
		<p class=links>
			<a href=/about/>About</a>
			<a href=/contact/>Contact</a>
			<a href=/privacy-policy/>Privacy Policy</a>
		</p>
		<p class=links>
			<span>Find me:</span>
			<a target=_blank href='https://twitter.com/sharat87'>Twitter</a>
			<a target=_blank href='https://github.com/sharat87'>GitHub</a>
			<a target=_blank href='https://www.linkedin.com/in/sharat87'>LinkedIn</a>
		</p>
	</div>
</footer>

<div id=cookiesOkBox class=hide>
	<p>This website uses cookies. By continuing to use this website, you agree to our use of
	cookies. <a href=/privacy-policy.html target=_blank title='Privacy Policy'>Know more</a>.</p>
	<p><button onclick='cookiesOkSave()'>Okay</button></p>
</div>

{% if config.dev_mode %}
	<p class=warning style='position:fixed;top:3px'>DEV MODE IS ON</p>
{% endif %}

<script>
setInterval(updateTimes, 60000);
updateTimes();
document.body.addEventListener('click', onBodyClick);

if (document.cookie.match(/(^|;\s*)cookiesOk=1(;|$)/))
	cookiesOkSave();  // Save again for it to expire in seven days from now.
else
	document.getElementById('cookiesOkBox').classList.remove('hide');

for (const el of document.querySelectorAll('sup.footnote-ref a'))
	el.setAttribute('title',
		document.getElementById(el.getAttribute('href').slice(1)).firstChild.textContent.trim());

for (const el of document.querySelectorAll('.hl')) {
	const buttons = [];
	if (el.dataset.lang == 'pycon')
		buttons.push(`<button type=button class=pycon-toggle-btn
			title="Hide output and '&gt;&gt;&gt;' prompt">&gt;&gt;&gt;</button>`);
	buttons.push('<button type=button class=copy-btn>Copy</button>');
	el.insertAdjacentHTML('beforeEnd', '<div class=btns>' + buttons.join('\n') + '</div>');
}

if (!localStorage.noga && !location.hostname.match(/localhost/)) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'UA-105705354-1');
	var s = document.createElement('script');
	s.async = true;
	s.src = '//www.googletagmanager.com/gtag/js?id=UA-105705354-1';
	s.setAttribute('data-timestamp', +new Date());
	document.body.appendChild(s);
}

function updateTimes() {
	for (const el of document.getElementsByTagName('time')) {
		el.title = el.title || el.textContent;
		el.textContent = timeSince(Date.parse(el.getAttribute('datetime')));
	}
}

function timeSince(date) {
	let i, u, s = Math.round((new Date() - date) / 100000);
	if ((i = Math.round(s / 315360)) >= 1) u = 'year';
	else if ((i = Math.round(s / 25920)) >= 1) u = 'month';
	else if ((i = Math.round(s / 864)) >= 1) u = 'day';
	return u ? `~${i} ${u}${i > 1 ? 's' : ''} ago` : 'today';
}

function cookiesOkSave() {
	const date = new Date();
	date.setTime(date.getTime() + (7*24*60*60*1000));
	document.cookie = 'cookiesOk=1; expires=' + date.toUTCString() + "; path=/";
	document.getElementById('cookiesOkBox').classList.add('hide');
}

function onBodyClick(event) {
	if (event.target.classList.contains('copy-btn'))
		copyCodeBlock(event.target);
	else if (event.target.classList.contains('pycon-toggle-btn'))
		togglePyconOutput(event.target);
}

function copyCodeBlock(btn) {
	const codeEl = btn.closest('.hl').querySelector('pre code').cloneNode(true);
	for (const el of codeEl.querySelectorAll('.hide'))
		el.remove();
	let text = codeEl.textContent.trim();
	if (text.includes('\n'))
		text += '\n';

	const te = document.createElement('textarea');
	te.style = 'position: fixed; top: 0; left: 0; width: 1px; height: 1px';
	document.body.appendChild(te);
	te.value = text;
	te.select();
	document.execCommand('copy');
	te.remove();

	const prevText = btn.innerText;
	btn.innerText = 'Copied!';
	btn.disabled = 1;
	setTimeout(() => {
		btn.innerText = prevText;
		btn.removeAttribute('disabled');
	}, 1000);
}

function togglePyconOutput(btn) {
	const preEl = btn.closest('.hl').querySelector('pre');
	for (const el of preEl.querySelectorAll('span.gp, span.go'))
		el.classList.toggle('hide');
}
</script>
